<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>

    <script>

      $(document).ready(function(){
        var $body = $('body');

        // Header
        var $header = $("<header></header>");
              $header.appendTo($body);

        var $title = $("<h1 class='title'></h1>");
              $title.html("Twittler");
              $title.appendTo($header);
        var $descrp = $("<h4 class='descrp'></h4>");
              var descpMessage = "Loading today's tweets as posted", count=0, buffer=["",".","..","..."];
              $descrp.html(descpMessage);
              $descrp.appendTo($header);

        // Section
        var $section = $("<section class = 'tweetList'></section>");
            $section.appendTo($body);

        var $ul = $("<ul></ul>");
            $ul.appendTo($header);
        var $li = $("<li class = 'userTweetList'></li>");
            $li.appendTo($ul);

        // Recursive function that automatically shows tweets as they are generated by data_generator.js
        function displayTweet(index){
          // Description '...' buffering
          count++;
           $descrp.html(descpMessage+buffer[count%4]);


          var tweet = streams.home[index];
          var $tweet = $('<div></div>');

          // Helper function to add <p> element with a given class
          $tweet.par = function(text,className){
            var p = $("<p>"+text+"</p>");
            if (arguments.length>1){
                p.addClass(className);
            }
            this.append(p);
          };

          $tweet.par("<span class='userName'>"+'@' + tweet.user + '</span>'+': ' + tweet.message.trim()[0].toUpperCase()+tweet.message.trim().slice(1),"tweetText");
          $tweet.par(tweet.created_at,"dateTime");

          $tweet.addClass("tweetBox");
          $tweet.prependTo($section).hide().fadeIn('slow');

          // Create a list of all generated tweets for the clicked user
          $tweet.on('click',function(){
              $li.remove();
              $li = $("<li class = 'userTweetList'></li>");
              $li.appendTo($ul);
              $li.append($("<h2 class='user'>"+"<b>@"+tweet.user+"</b>"+"</h2>"));

              var $tweetItem;
              streams.users[tweet.user].forEach(function(item){
                  $tweetItem = $("<p>"+item.created_at+":   "+item.message.trim()[0].toUpperCase()+item.message.trim().slice(1)+"</p>");
                  $tweetItem.addClass("userTweet");
                  $tweetItem.appendTo($li);
              })
              $li.slideDown();
          });


          setTimeout(function(){displayTweet(index + 1);}, 1500);
        };

        // Initiate recursion
        displayTweet(0);

      });

    </script>
  </body>
</html>
